package ie.sortons.events.server.servlet;

import static org.junit.Assert.assertEquals;
import ie.sortons.events.shared.ClientPageData;
import ie.sortons.events.shared.DiscoveredEvent;
import ie.sortons.gwtfbplus.server.fql.FqlStream;
import ie.sortons.gwtfbplus.server.fql.FqlStream.FqlStreamItemAttachment;
import ie.sortons.gwtfbplus.server.fql.FqlStream.FqlStreamItemAttachmentAdapter;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.TreeSet;

import javax.servlet.http.HttpServletResponse;

import org.junit.Before;
import org.junit.Test;
import org.mockito.Mockito;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

public class CollectorCronTest {

	private CollectorCron cc = new CollectorCron();

	private ClientPageData clientPageData;

	private Gson gson = new GsonBuilder().registerTypeAdapter(FqlStreamItemAttachment.class, new FqlStreamItemAttachmentAdapter()).create();

	private HttpServletResponse response = Mockito.mock(HttpServletResponse.class); 

	PrintWriter out;

	@Before
	public void setup() throws IOException {

		String cpdJson = "{    \"clientPageId\": \"176727859052209\",    \"clientPage\": {        \"pageId\": \"176727859052209\",        \"name\": \"Sortons Bistro\",        \"pageUrl\": \"http://www.facebook.com/pages/Sortons-Bistro/176727859052209\"    },    \"includedPages\": [        {            \"pageId\": \"176727859052209\",            \"name\": \"Sortons Bistro\",            \"pageUrl\": \"http://www.facebook.com/pages/Sortons-Bistro/176727859052209\"        },        {            \"pageId\": \"180585223095\",            \"name\": \"Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/wicklowtown\"        },        {            \"pageId\": \"144085445617928\",            \"name\": \"Hopkins Toymaster\",            \"pageUrl\": \"http://www.facebook.com/hopkinstoymaster1827\"        },        {            \"pageId\": \"195462027143869\",            \"name\": \"Wicklow Parish Summer Fete\",            \"pageUrl\": \"http://www.facebook.com/WicklowParishSummerFete\"        },        {            \"pageId\": \"153597848050326\",            \"name\": \"The Cats Pyjamas Cattery Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/The-Cats-Pyjamas-Cattery-Wicklow/153597848050326\"        },        {            \"pageId\": \"327354357259\",            \"name\": \"Wicklow Veterinary Clinic\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Veterinary-Clinic/327354357259\"        },        {            \"pageId\": \"140345306086891\",            \"name\": \"WicklowTown.ie\",            \"pageUrl\": \"http://www.facebook.com/WicklowTown.ie\"        },        {            \"pageId\": \"142002899168824\",            \"name\": \"Heels- Ashford and Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/Heels.ie\"        },        {            \"pageId\": \"261291960566266\",            \"name\": \"Wicklow Arts Festival\",            \"pageUrl\": \"http://www.facebook.com/wicklow.artsfestival\"        },        {            \"pageId\": \"427072610713452\",            \"name\": \"Wicklow Tourism\",            \"pageUrl\": \"http://www.facebook.com/wicklow.tourism\"        },        {            \"pageId\": \"210398799111123\",            \"name\": \"Wicklow events\",            \"pageUrl\": \"http://www.facebook.com/wicklowevents\"        },        {            \"pageId\": \"509676619068377\",            \"name\": \"RockSkool.ie-Kilcoole Co.Wicklow\",            \"pageUrl\": \"http://www.facebook.com/RockSkoolMusic\"        },        {            \"pageId\": \"439340592846537\",            \"name\": \"Strictly Wicklow\",            \"pageUrl\": \"http://www.facebook.com/strictlywicklow\"        },        {            \"pageId\": \"196662593706553\",            \"name\": \"Wicklow Mykidstime\",            \"pageUrl\": \"http://www.facebook.com/Mykidstime.Wicklow\"        },        {            \"pageId\": \"206856689327295\",            \"name\": \"Wicklow Outdoors\",            \"pageUrl\": \"http://www.facebook.com/wicklowoutdoors\"        },        {            \"pageId\": \"133373533398528\",            \"name\": \"Ooooby-Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Ooooby-Wicklow/133373533398528\"        },        {            \"pageId\": \"152768388123618\",            \"name\": \"Wicklow Wine Co\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Wine-Co/152768388123618\"        },        {            \"pageId\": \"154783771243869\",            \"name\": \"Wicklow Gardens\",            \"pageUrl\": \"http://www.facebook.com/WicklowGardens\"        },        {            \"pageId\": \"135855496547\",            \"name\": \"Wicklow Jail\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Jail/135855496547\"        },        {            \"pageId\": \"139585832877561\",            \"name\": \"Foroige Wicklow Town Dudes & Divas\",            \"pageUrl\": \"http://www.facebook.com/pages/Foroige-Wicklow-Town-Dudes-Divas/139585832877561\"        },        {            \"pageId\": \"501725423220151\",            \"name\": \"Wicklow Photowalks & Workshops\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Photowalks-Workshops/501725423220151\"        },        {            \"pageId\": \"204563096335129\",            \"name\": \"Wicklow lost or found animals\",            \"pageUrl\": \"http://www.facebook.com/WicklowLostOrFoundAnimals\"        },        {            \"pageId\": \"148533678514648\",            \"name\": \"Wicklow County Enterprise Board\",            \"pageUrl\": \"http://www.facebook.com/wicklowenterpriseboard\"        },        {            \"pageId\": \"113134808716107\",            \"name\": \"Wicklow Hospice Foundation\",            \"pageUrl\": \"http://www.facebook.com/wicklowhospicefoundation\"        },        {            \"pageId\": \"106959406085130\",            \"name\": \"Wicklow Triathlon Club\",            \"pageUrl\": \"http://www.facebook.com/wicklowtriclub\"        },        {            \"pageId\": \"97908968195\",            \"name\": \"THE CAVE  ~Creative Arts Venture~,  WICKLOW TOWN\",            \"pageUrl\": \"http://www.facebook.com/TheCave.Wicklow\"        },        {            \"pageId\": \"107747952581273\",            \"name\": \"Wicklow GAA\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-GAA/107747952581273\"        },        {            \"pageId\": \"109205172443220\",            \"name\": \"West Wicklow Classic and Vintage Vehicle Club ( wwcvvc )\",            \"pageUrl\": \"http://www.facebook.com/WWCVVC\"        },        {            \"pageId\": \"207036582745784\",            \"name\": \"Wicklow Swimming Club\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Swimming-Club/207036582745784\"        },        {            \"pageId\": \"558775077501699\",            \"name\": \"EAI T/A Wicklow Way\",            \"pageUrl\": \"http://www.facebook.com/ecoactiveireland\"        },        {            \"pageId\": \"376218045727617\",            \"name\": \"St Patricks Day Parade Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/pages/St-Patricks-Day-Parade-Wicklow-Town/376218045727617\"        },        {            \"pageId\": \"417427591636316\",            \"name\": \"Wicklow kite festival\",            \"pageUrl\": \"http://www.facebook.com/WKFestival\"        },        {            \"pageId\": \"355118561181327\",            \"name\": \"Wicklow Dogs\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Dogs/355118561181327\"        },        {            \"pageId\": \"145408198834577\",            \"name\": \"wicklownews.net\",            \"pageUrl\": \"http://www.facebook.com/wicklownews\"        },        {            \"pageId\": \"184552674915335\",            \"name\": \"Wicklow County Arts Office\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-County-Arts-Office/184552674915335\"        },        {            \"pageId\": \"355501164464897\",            \"name\": \"Wicklow Weather\",            \"pageUrl\": \"http://www.facebook.com/wicklowweather\"        },        {            \"pageId\": \"132998870093195\",            \"name\": \"Wicklow Rugby Club minis section\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Rugby-Club-minis-section/132998870093195\"        },        {            \"pageId\": \"194857740543201\",            \"name\": \"Vocational School Carnew Co Wicklow.\",            \"pageUrl\": \"http://www.facebook.com/pages/Vocational-School-Carnew-Co-Wicklow/194857740543201\"        },        {            \"pageId\": \"124931677522919\",            \"name\": \"Have Your Cake And Eat It Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/pages/Have-Your-Cake-And-Eat-It-Wicklow-Town/124931677522919\"        },        {            \"pageId\": \"429604960418138\",            \"name\": \"Wicklow Junior Chess\",            \"pageUrl\": \"http://www.facebook.com/WicklowJuniorChess\"        },        {            \"pageId\": \"184520938250216\",            \"name\": \"WOW Whats On Wicklow\",            \"pageUrl\": \"http://www.facebook.com/whatsonWOW\"        },        {            \"pageId\": \"183791358269\",            \"name\": \"Wicklow Tidy Towns\",            \"pageUrl\": \"http://www.facebook.com/WicklowTidyTowns\"        },        {            \"pageId\": \"303022625484\",            \"name\": \"Wicklow RNLI Fundraising Branch\",            \"pageUrl\": \"http://www.facebook.com/WicklowRNLIFundraising\"        },        {            \"pageId\": \"231946786847785\",            \"name\": \"Wicklow Chamber\",            \"pageUrl\": \"http://www.facebook.com/wicklowchamber\"        },        {            \"pageId\": \"197777173652140\",            \"name\": \"Wicklow & District Credit Union Ltd\",            \"pageUrl\": \"http://www.facebook.com/wicklowcu\"        },        {            \"pageId\": \"160142460806715\",            \"name\": \"Wicklow Community Circus\",            \"pageUrl\": \"http://www.facebook.com/WicklowCommunityCircus\"        },        {            \"pageId\": \"106562746033733\",            \"name\": \"WAR: Wicklow Adventure Race\",            \"pageUrl\": \"http://www.facebook.com/warwicklowadventurerace\"        },        {            \"pageId\": \"421631631239284\",            \"name\": \"Wicklow Handmade Pens\",            \"pageUrl\": \"http://www.facebook.com/wicklowhandmadepens\"        },        {            \"pageId\": \"151512758312767\",            \"name\": \"Wicklow Dyspraxia/DCD/Dyslexia Information Page\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-DyspraxiaDCDDyslexia-Information-Page/151512758312767\"        },        {            \"pageId\": \"159746484091814\",            \"name\": \"Wicklow Gaol\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Gaol/159746484091814\"        },        {            \"pageId\": \"36872057519\",            \"name\": \"Mermaid County Wicklow Arts Centre\",            \"pageUrl\": \"http://www.facebook.com/MermaidCountyWicklowArtsCentre\"        },        {            \"pageId\": \"277129009088670\",            \"name\": \"Wicklow Community Notices\",            \"pageUrl\": \"http://www.facebook.com/wicklowcommunitynotices\"        },        {            \"pageId\": \"279747125502999\",            \"name\": \"Wicklow Snapchat\",            \"pageUrl\": \"http://www.facebook.com/WicklowSnapchat\"        },        {            \"pageId\": \"128437187214323\",            \"name\": \"Dominican College Wicklow Fundraising For the School of St Jude Tanzania\",            \"pageUrl\": \"http://www.facebook.com/pages/Dominican-College-Wicklow-Fundraising-For-the-School-of-St-Jude-Tanzania/128437187214323\"        },        {            \"pageId\": \"103394793051494\",            \"name\": \"Pet depot wicklow\",            \"pageUrl\": \"http://www.facebook.com/PetDepotWicklow\"        },        {            \"pageId\": \"144841699045624\",            \"name\": \"Wicklow Food and Garden Festival\",            \"pageUrl\": \"http://www.facebook.com/WicklowFoodAndGardenFestival\"        },        {            \"pageId\": \"200868766643632\",            \"name\": \"Wicklow Mental Health Association\",            \"pageUrl\": \"http://www.facebook.com/wicklowmentalhealth\"        },        {            \"pageId\": \"538318012896657\",            \"name\": \"Singing Lessons in Wicklow\",            \"pageUrl\": \"http://www.facebook.com/singinglessonsinwicklow\"        },        {            \"pageId\": \"213154872182320\",            \"name\": \"Wicklow Boxing Club\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Boxing-Club/213154872182320\"        },        {            \"pageId\": \"160504700636255\",            \"name\": \"Wicklow RNLI Lifeboat Station\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-RNLI-Lifeboat-Station/160504700636255\"        },        {            \"pageId\": \"103107273062739\",            \"name\": \"Glenealy, County Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Glenealy-County-Wicklow/103107273062739\"        },        {            \"pageId\": \"134297223363802\",            \"name\": \"The Gathering Wicklow 2013\",            \"pageUrl\": \"http://www.facebook.com/CountyWicklowGathering\"        },        {            \"pageId\": \"156016647746446\",            \"name\": \"Wicklow Town A.F.C\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Town-AFC/156016647746446\"        },        {            \"pageId\": \"157657640950008\",            \"name\": \"Wicklow County Council Library Service\",            \"pageUrl\": \"http://www.facebook.com/WicklowLibraries\"        },        {            \"pageId\": \"259696117507828\",            \"name\": \"STOMP Marketing & PR in Co Wicklow\",            \"pageUrl\": \"http://www.facebook.com/stompmarketingPR\"        },        {            \"pageId\": \"40069605687\",            \"name\": \"Bray  // C.o Wicklow Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/Bray-Co-Wicklow-Ireland/40069605687\"        },        {            \"pageId\": \"115976565146677\",            \"name\": \"Wicklow Macra\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Macra/115976565146677\"        },        {            \"pageId\": \"102180916490258\",            \"name\": \"Wicklow, Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Ireland/102180916490258\"        },        {            \"pageId\": \"120498064773999\",            \"name\": \"Wicklow Camera Club\",            \"pageUrl\": \"http://www.facebook.com/WicklowCameraClub\"        },        {            \"pageId\": \"167628113269431\",            \"name\": \"Wicklow Special Offers\",            \"pageUrl\": \"http://www.facebook.com/WicklowOffers\"        },        {            \"pageId\": \"145934835436569\",            \"name\": \"Wardrobe, Wicklow\",            \"pageUrl\": \"http://www.facebook.com/WardrobeWicklow\"        },        {            \"pageId\": \"1408504836030140\",            \"name\": \"Watching wicklow\",            \"pageUrl\": \"http://www.facebook.com/watchingwicklow\"        },        {            \"pageId\": \"116895565049332\",            \"name\": \"Phil Healy's Pub, Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/philhealys\"        },        {            \"pageId\": \"148468435223420\",            \"name\": \"WicklowTrad.com\",            \"pageUrl\": \"http://www.facebook.com/WicklowTrad\"        },        {            \"pageId\": \"261177883916297\",            \"name\": \"Bands For Boats-Wicklow RNLI fundraiser\",            \"pageUrl\": \"http://www.facebook.com/pages/Bands-For-Boats-Wicklow-RNLI-fundraiser/261177883916297\"        },        {            \"pageId\": \"371773307562\",            \"name\": \"Wicklow Town Hostel\",            \"pageUrl\": \"http://www.facebook.com/HostelWicklow\"        },        {            \"pageId\": \"324455570981308\",            \"name\": \"Startup Wicklow\",            \"pageUrl\": \"http://www.facebook.com/StartupWicklow\"        },        {            \"pageId\": \"116541711693851\",            \"name\": \"Wicklow Round Ireland Sailfest\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Round-Ireland-Sailfest/116541711693851\"        },        {            \"pageId\": \"12516136484\",            \"name\": \"Bridge Street Books Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Bridge-Street-Books-Wicklow/12516136484\"        },        {            \"pageId\": \"251238991630829\",            \"name\": \"Wicklow Enterprise Park\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Enterprise-Park/251238991630829\"        },        {            \"pageId\": \"10150091628215591\",            \"name\": \"Woodenbridge Hotel & Lodge, Wicklow\",            \"pageUrl\": \"http://www.facebook.com/WoodenbridgeHotelandLodge\"        },        {            \"pageId\": \"87804145777\",            \"name\": \"Summerhill House Hotel, Wicklow\",            \"pageUrl\": \"http://www.facebook.com/summerhillhousehotel\"        },        {            \"pageId\": \"182705418563422\",            \"name\": \"The Gardens Of Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/The-Gardens-Of-Wicklow/182705418563422\"        },        {            \"pageId\": \"109284509099289\",            \"name\": \"Blainroe, Wicklow, Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/Blainroe-Wicklow-Ireland/109284509099289\"        },        {            \"pageId\": \"122007291762\",            \"name\": \"Wicklow Regatta Festival\",            \"pageUrl\": \"http://www.facebook.com/WicklowRegattaFestival\"        },        {            \"pageId\": \"108117582556198\",            \"name\": \"Wicklow Kabs - 66888\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Kabs-66888/108117582556198\"        },        {            \"pageId\": \"263806556977235\",            \"name\": \"Ballyknocken House Cookery School, Co. Wicklow.\",            \"pageUrl\": \"http://www.facebook.com/pages/Ballyknocken-House-Cookery-School-Co-Wicklow/263806556977235\"        },        {            \"pageId\": \"110444572315706\",            \"name\": \"Hartstown, Wicklow, Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/Hartstown-Wicklow-Ireland/110444572315706\"        },        {            \"pageId\": \"123311214379715\",            \"name\": \"County Wicklow, Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/County-Wicklow-Ireland/123311214379715\"        },        {            \"pageId\": \"204587016226812\",            \"name\": \"Wicklow Golf Club\",            \"pageUrl\": \"http://www.facebook.com/wicklowgolfclub\"        },        {            \"pageId\": \"111620038858137\",            \"name\": \"Ballygannon, Wicklow, Ireland\",            \"pageUrl\": \"http://www.facebook.com/pages/Ballygannon-Wicklow-Ireland/111620038858137\"        },        {            \"pageId\": \"113027872057537\",            \"name\": \"Wicklow Cancer Support\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Cancer-Support/113027872057537\"        },        {            \"pageId\": \"105509379484220\",            \"name\": \"Space Inside Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/pages/Space-Inside-Wicklow-Town/105509379484220\"        },        {            \"pageId\": \"545265462176942\",            \"name\": \"Wicklow Holistic Retreats\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Holistic-Retreats/545265462176942\"        },        {            \"pageId\": \"272934752731268\",            \"name\": \"Aughrim, Co. Wicklow Events Guide\",            \"pageUrl\": \"http://www.facebook.com/pages/Aughrim-Co-Wicklow-Events-Guide/272934752731268\"        },        {            \"pageId\": \"130017223732336\",            \"name\": \"Wicklow Montessori Primary School\",            \"pageUrl\": \"http://www.facebook.com/wicklowmontessoriprimaryschool\"        },        {            \"pageId\": \"142083712551384\",            \"name\": \"Wicklow Disability Group\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Disability-Group/142083712551384\"        },        {            \"pageId\": \"219122368147481\",            \"name\": \"Halloween in Wicklow\",            \"pageUrl\": \"http://www.facebook.com/HalloweeninWicklow\"        },        {            \"pageId\": \"359103824111918\",            \"name\": \"Wicklow Community Garden 2012\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Community-Garden-2012/359103824111918\"        },        {            \"pageId\": \"157386547666491\",            \"name\": \"Wicklow Toastmasters\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Toastmasters/157386547666491\"        },        {            \"pageId\": \"198477380164681\",            \"name\": \"Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow/198477380164681\"        },        {            \"pageId\": \"178881055485251\",            \"name\": \"Stephen Donnelly for Wicklow\",            \"pageUrl\": \"http://www.facebook.com/DonnellyforWicklow\"        },        {            \"pageId\": \"354216523796\",            \"name\": \"Wicklow GAA Photos\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-GAA-Photos/354216523796\"        },        {            \"pageId\": \"160720457332233\",            \"name\": \"Wicklow GAA\",            \"pageUrl\": \"http://www.facebook.com/WicklowGAA\"        },        {            \"pageId\": \"343746670780\",            \"name\": \"The Wicklow Heather\",            \"pageUrl\": \"http://www.facebook.com/pages/The-Wicklow-Heather/343746670780\"        },        {            \"pageId\": \"125202347556447\",            \"name\": \"Wicklow Directory\",            \"pageUrl\": \"http://www.facebook.com/WicklowDirectory\"        },        {            \"pageId\": \"127113230709031\",            \"name\": \"Wicklow County Council Planning and Heritage Office\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-County-Council-Planning-and-Heritage-Office/127113230709031\"        },        {            \"pageId\": \"184831150589\",            \"name\": \"Dublin Wicklow MR Team\",            \"pageUrl\": \"http://www.facebook.com/DWMRT\"        },        {            \"pageId\": \"243487329063078\",            \"name\": \"Kildare/Wicklow Destination\",            \"pageUrl\": \"http://www.facebook.com/pages/KildareWicklow-Destination/243487329063078\"        },        {            \"pageId\": \"139031682850966\",            \"name\": \"Wicklow RFC\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-RFC/139031682850966\"        },        {            \"pageId\": \"152286738253651\",            \"name\": \"Operation Transformation Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/OperationTransformationWicklowTown\"        },        {            \"pageId\": \"279123598766426\",            \"name\": \"Wicklow Ladies Football\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Ladies-Football/279123598766426\"        },        {            \"pageId\": \"131811223556744\",            \"name\": \"Wicklow - SPCA\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-SPCA/131811223556744\"        },        {            \"pageId\": \"170785756317317\",            \"name\": \"Wicklow Animal Welfare\",            \"pageUrl\": \"http://www.facebook.com/WicklowAnimalWelfare\"        },        {            \"pageId\": \"166626530151932\",            \"name\": \"Madeinwicklow Writing\",            \"pageUrl\": \"http://www.facebook.com/Madeinwicklow\"        },        {            \"pageId\": \"210103215721449\",            \"name\": \"Foróige Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/For%C3%B3ige-Wicklow/210103215721449\"        },        {            \"pageId\": \"106160539451370\",            \"name\": \"North Wicklow/South Dublin ET 2nd Level Action Group\",            \"pageUrl\": \"http://www.facebook.com/pages/North-WicklowSouth-Dublin-ET-2nd-Level-Action-Group/106160539451370\"        },        {            \"pageId\": \"139719246134603\",            \"name\": \"Wicklow Jazz at The Mezzanine Cafe\",            \"pageUrl\": \"http://www.facebook.com/WicklowJazz\"        },        {            \"pageId\": \"220256888023332\",            \"name\": \"Wicklow Business Network\",            \"pageUrl\": \"http://www.facebook.com/wicklowconet\"        },        {            \"pageId\": \"242188242499704\",            \"name\": \"Business in Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Business-in-Wicklow/242188242499704\"        },        {            \"pageId\": \"191593624272023\",            \"name\": \"County Wicklow (The Garden of Ireland)\",            \"pageUrl\": \"http://www.facebook.com/pages/County-Wicklow-The-Garden-of-Ireland/191593624272023\"        },        {            \"pageId\": \"370577509665821\",            \"name\": \"County Wicklow Partnership Festivals & Events Forum\",            \"pageUrl\": \"http://www.facebook.com/CountyWicklowPartnershipFestivalsEvents\"        },        {            \"pageId\": \"261433833868972\",            \"name\": \"Wicklow Mountains National Park\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Mountains-National-Park/261433833868972\"        },        {            \"pageId\": \"443615702328176\",            \"name\": \"Radio Nova, Wicklow - 95.7 FM & 100.3 FM\",            \"pageUrl\": \"http://www.facebook.com/radionovawicklow\"        },        {            \"pageId\": \"172141782813841\",            \"name\": \"Wicklow County Childcare\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-County-Childcare/172141782813841\"        },        {            \"pageId\": \"113825605347920\",            \"name\": \"Christmas Gift and Craft Fair Wicklow Town\",            \"pageUrl\": \"http://www.facebook.com/pages/Christmas-Gift-and-Craft-Fair-Wicklow-Town/113825605347920\"        },        {            \"pageId\": \"253113681408336\",            \"name\": \"Wicklow Male Voice Choir  Christmas Concert\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Male-Voice-Choir-Christmas-Concert/253113681408336\"        },        {            \"pageId\": \"392343744152126\",            \"name\": \"Wicklow Page\",            \"pageUrl\": \"http://www.facebook.com/wicklow.page\"        },        {            \"pageId\": \"329020330496865\",            \"name\": \"Wicklow Community Forum\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Community-Forum/329020330496865\"        },        {            \"pageId\": \"430352633728129\",            \"name\": \"Wicklow Hockey Club\",            \"pageUrl\": \"http://www.facebook.com/wicklow.hockeyclub\"        },        {            \"pageId\": \"178145885603837\",            \"name\": \"BirdWatch Ireland Wicklow Branch\",            \"pageUrl\": \"http://www.facebook.com/birdwatchwicklow\"        },        {            \"pageId\": \"324754317539958\",            \"name\": \"Wicklow Comhairle na nÓg\",            \"pageUrl\": \"http://www.facebook.com/WicklowComhairlenanOg\"        },        {            \"pageId\": \"633311706682180\",            \"name\": \"The Wicklow Rock Art Project\",            \"pageUrl\": \"http://www.facebook.com/WicklowRockArtProject\"        },        {            \"pageId\": \"479433408740578\",            \"name\": \"East Coast Surf School\",            \"pageUrl\": \"http://www.facebook.com/eastcoastsurfschool\"        },        {            \"pageId\": \"143751348969384\",            \"name\": \"Wicklow County Council\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-County-Council/143751348969384\"        },        {            \"pageId\": \"425211207584541\",            \"name\": \"Wicklow League Fixtures/Results\",            \"pageUrl\": \"http://www.facebook.com/wicklowleague\"        },        {            \"pageId\": \"104724622937571\",            \"name\": \"Wicklow Child & Family Project\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Child-Family-Project/104724622937571\"        },        {            \"pageId\": \"459197237512845\",            \"name\": \"Wicklow Skate Park & Outdoor Gym\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Skate-Park-Outdoor-Gym/459197237512845\"        },        {            \"pageId\": \"205639146187108\",            \"name\": \"The Wicklow Town Retailers Group\",            \"pageUrl\": \"http://www.facebook.com/pages/The-Wicklow-Town-Retailers-Group/205639146187108\"        },        {            \"pageId\": \"468419026566601\",            \"name\": \"Wicklow Nature\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Nature/468419026566601\"        },        {            \"pageId\": \"214891775203340\",            \"name\": \"Wicklow Town & District Chamber of Commerce\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Town-District-Chamber-of-Commerce/214891775203340\"        },        {            \"pageId\": \"203533826366131\",            \"name\": \"EmployAbility Service Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/EmployAbility-Service-Wicklow/203533826366131\"        },        {            \"pageId\": \"242737693361\",            \"name\": \"Wicklow Bowl & KidZone\",            \"pageUrl\": \"http://www.facebook.com/Wicklowbowlkidzone\"        },        {            \"pageId\": \"606783826021299\",            \"name\": \"Wicklow Fitness by WLD Dance & Fitness\",            \"pageUrl\": \"http://www.facebook.com/WLDFitness\"        },        {            \"pageId\": \"301328169973421\",            \"name\": \"Wicklow Broadband\",            \"pageUrl\": \"http://www.facebook.com/WicklowBband\"        },        {            \"pageId\": \"147978328734171\",            \"name\": \"Wicklow Rose 2013\",            \"pageUrl\": \"http://www.facebook.com/wicklowrose2013\"        },        {            \"pageId\": \"137090586311867\",            \"name\": \"Wicklow (Dáil Éireann constituency)\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-D%C3%A1il-%C3%89ireann-constituency/137090586311867\"        },        {            \"pageId\": \"109254272433853\",            \"name\": \"Wicklow RFC\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-RFC/109254272433853\"        },        {            \"pageId\": \"322962794463458\",            \"name\": \"Paranormal Wicklow Gaol\",            \"pageUrl\": \"http://www.facebook.com/pages/Paranormal-Wicklow-Gaol/322962794463458\"        },        {            \"pageId\": \"400351246641892\",            \"name\": \"Wicklow Boat Charters\",            \"pageUrl\": \"http://www.facebook.com/WicklowBoatCharters\"        },        {            \"pageId\": \"357827910941996\",            \"name\": \"Music Generation Wicklow\",            \"pageUrl\": \"http://www.facebook.com/pages/Music-Generation-Wicklow/357827910941996\"        },        {            \"pageId\": \"130347813699609\",            \"name\": \"Wicklow's Historic Gaol\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklows-Historic-Gaol/130347813699609\"        },        {            \"pageId\": \"133245870071254\",            \"name\": \"The Wicklow Way\",            \"pageUrl\": \"http://www.facebook.com/walkingthewicklowway\"        },        {            \"pageId\": \"109485365744524\",            \"name\": \"Wicklow Mountains\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Mountains/109485365744524\"        },        {            \"pageId\": \"222875104515501\",            \"name\": \"Wicklow\",            \"pageUrl\": \"http://www.facebook.com/wicklowofficial\"        },        {            \"pageId\": \"210411599028045\",            \"name\": \"Christmas in Wicklow\",            \"pageUrl\": \"http://www.facebook.com/ChristmasinWicklow\"        },        {            \"pageId\": \"102582896483653\",            \"name\": \"Wicklow Town Council\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Town-Council/102582896483653\"        },        {            \"pageId\": \"320453224661617\",            \"name\": \"Wicklow Food Producers\",            \"pageUrl\": \"http://www.facebook.com/WicklowFood\"        },        {            \"pageId\": \"275776349151431\",            \"name\": \"Wicklow Town Ireland.\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Town-Ireland/275776349151431\"        },        {            \"pageId\": \"191784260848719\",            \"name\": \"Wicklow Sailing Club\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Sailing-Club/191784260848719\"        },        {            \"pageId\": \"160913113943786\",            \"name\": \"Wicklow Local Authorities\",            \"pageUrl\": \"http://www.facebook.com/WicklowCountyCouncil\"        },        {            \"pageId\": \"195461990496616\",            \"name\": \"Wicklow Dinghy Sailing\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-Dinghy-Sailing/195461990496616\"        },        {            \"pageId\": \"200204546665229\",            \"name\": \"Wicklow SPCA\",            \"pageUrl\": \"http://www.facebook.com/pages/Wicklow-SPCA/200204546665229\"        },        {            \"pageId\": \"77722956378\",            \"name\": \"Halpin's Bridge Cafe\",            \"pageUrl\": \"http://www.facebook.com/halpinsbridgecafe\"        }    ],    \"ignoredPages\": [        {            \"pageId\": \"130806596969418\",            \"name\": \"Keep Going Sure It's Grand\",            \"pageUrl\": \"http://www.facebook.com/keepgoingsureitsgrand\"        },        {            \"pageId\": \"107431775978628\",            \"name\": \"The Whipround\",            \"pageUrl\": \"http://www.facebook.com/pages/The-Whipround/107431775978628\"        },        {            \"pageId\": \"162908837053953\",            \"name\": \"Total Car Care, Glenealy\",            \"pageUrl\": \"http://www.facebook.com/pages/Total-Car-Care-Glenealy/162908837053953\"        },        {            \"pageId\": \"264435814478\",            \"name\": \"HilltopTreks\",            \"pageUrl\": \"http://www.facebook.com/pages/HilltopTreks/264435814478\"        },        {            \"pageId\": \"220018101365634\",            \"name\": \"MyStreet.ie\",            \"pageUrl\": \"http://www.facebook.com/MyStreet.ie\"        },        {            \"pageId\": \"103921891271\",            \"name\": \"Glenview Hotel Wicklow\",            \"pageUrl\": \"http://www.facebook.com/glenviewhotel\"        },        {            \"pageId\": \"165692700154574\",            \"name\": \"Conways Toymaster Sunderland\",            \"pageUrl\": \"http://www.facebook.com/pages/Conways-Toymaster-Sunderland/165692700154574\"        },        {            \"pageId\": \"100002069652985\",            \"name\": \"Wynnes Bar Wicklow\",            \"pageUrl\": \"http://www.facebook.com/wynnes.wicklow\"        }    ],    \"includedPageIds\": [        \"176727859052209\",        \"180585223095\",        \"144085445617928\",        \"195462027143869\",        \"153597848050326\",        \"327354357259\",        \"140345306086891\",        \"142002899168824\",        \"261291960566266\",        \"427072610713452\",        \"210398799111123\",        \"509676619068377\",        \"439340592846537\",        \"196662593706553\",        \"206856689327295\",        \"133373533398528\",        \"152768388123618\",        \"154783771243869\",        \"135855496547\",        \"139585832877561\",        \"501725423220151\",        \"204563096335129\",        \"148533678514648\",        \"113134808716107\",        \"106959406085130\",        \"97908968195\",        \"107747952581273\",        \"109205172443220\",        \"207036582745784\",        \"558775077501699\",        \"376218045727617\",        \"417427591636316\",        \"355118561181327\",        \"145408198834577\",        \"184552674915335\",        \"355501164464897\",        \"132998870093195\",        \"194857740543201\",        \"124931677522919\",        \"429604960418138\",        \"184520938250216\",        \"183791358269\",        \"303022625484\",        \"231946786847785\",        \"197777173652140\",        \"160142460806715\",        \"106562746033733\",        \"421631631239284\",        \"151512758312767\",        \"159746484091814\",        \"36872057519\",        \"277129009088670\",        \"279747125502999\",        \"128437187214323\",        \"103394793051494\",        \"144841699045624\",        \"200868766643632\",        \"538318012896657\",        \"213154872182320\",        \"160504700636255\",        \"103107273062739\",        \"134297223363802\",        \"156016647746446\",        \"157657640950008\",        \"259696117507828\",        \"40069605687\",        \"115976565146677\",        \"102180916490258\",        \"120498064773999\",        \"167628113269431\",        \"145934835436569\",        \"1408504836030140\",        \"116895565049332\",        \"148468435223420\",        \"261177883916297\",        \"371773307562\",        \"324455570981308\",        \"116541711693851\",        \"12516136484\",        \"251238991630829\",        \"10150091628215591\",        \"87804145777\",        \"182705418563422\",        \"109284509099289\",        \"122007291762\",        \"108117582556198\",        \"263806556977235\",        \"110444572315706\",        \"123311214379715\",        \"204587016226812\",        \"111620038858137\",        \"113027872057537\",        \"105509379484220\",        \"545265462176942\",        \"272934752731268\",        \"130017223732336\",        \"142083712551384\",        \"219122368147481\",        \"359103824111918\",        \"157386547666491\",        \"198477380164681\",        \"178881055485251\",        \"354216523796\",        \"160720457332233\",        \"343746670780\",        \"125202347556447\",        \"127113230709031\",        \"184831150589\",        \"243487329063078\",        \"139031682850966\",        \"152286738253651\",        \"279123598766426\",        \"131811223556744\",        \"170785756317317\",        \"166626530151932\",        \"210103215721449\",        \"106160539451370\",        \"139719246134603\",        \"220256888023332\",        \"242188242499704\",        \"191593624272023\",        \"370577509665821\",        \"261433833868972\",        \"443615702328176\",        \"172141782813841\",        \"113825605347920\",        \"253113681408336\",        \"392343744152126\",        \"329020330496865\",        \"430352633728129\",        \"178145885603837\",        \"324754317539958\",        \"633311706682180\",        \"479433408740578\",        \"143751348969384\",        \"425211207584541\",        \"104724622937571\",        \"459197237512845\",        \"205639146187108\",        \"468419026566601\",        \"214891775203340\",        \"203533826366131\",        \"242737693361\",        \"606783826021299\",        \"301328169973421\",        \"147978328734171\",        \"137090586311867\",        \"109254272433853\",        \"322962794463458\",        \"400351246641892\",        \"357827910941996\",        \"130347813699609\",        \"133245870071254\",        \"109485365744524\",        \"222875104515501\",        \"210411599028045\",        \"102582896483653\",        \"320453224661617\",        \"275776349151431\",        \"191784260848719\",        \"160913113943786\",        \"195461990496616\",        \"200204546665229\",        \"77722956378\"    ],    \"ignoredPageIds\": [        \"130806596969418\",        \"107431775978628\",        \"162908837053953\",        \"264435814478\",        \"220018101365634\",        \"103921891271\",        \"165692700154574\",        \"100002069652985\"    ]}";

		PrintWriter writer = new PrintWriter("somefile.txt");
		Mockito.when(response.getWriter()).thenReturn(writer);
		out = response.getWriter();
		
		//when(response.getWriter()).thenReturn(writer);
		
		clientPageData  = gson.fromJson(cpdJson, ClientPageData.class); 
		cc.setPrintWriter(response.getWriter());
	}


	@Test
	public void testFindEventsInStreamPosts() {

		String emptyJson = "{\"data\":[]}";
		String noEventJson = "{\"data\":[{\"source_id\":77722956378,\"post_id\":\"77722956378_10151797005956379\",\"actor_id\":77722956378,\"target_id\":null,\"message\":\"SPECIAL OFFERS IN HALPIN'S BRIDGE CAFE MON-FRI.\nSome great offers, Take-away soup and regualr sandwich for only \u20ac5 (toasted \u20ac5.50)\nEat in, Soup and regular sandwich \u20ac6 (toasted \u20ac6.50)\nThats a soup & sandwich, great value.\n(does not include gourmet sandwiches of the daily specials menu)\",\"attachment\":[]},{\"source_id\":77722956378,\"post_id\":\"77722956378_10151784024016379\",\"actor_id\":77722956378,\"target_id\":null,\"message\":\"Well folks, it's the weekend and we have on some great things for Saturday & Sunday.\nWe have on our full Irish breakfast from only \u20ac4.95, and scrambled egss with bacon sausages or lovely Irish smoked salmon and then some really lovely specials.\nSlow cooked Irish lamb stew to warm you up, vegetarian options include goats cheese and red pepper Quiche, stuffed mushrooms, and our incredible new Gourmet sandwich range, Ken's coronation chicken on chunky bloomer bread with side salad, Home cooked roast beef with red onion marmalade, and our jamaican suprise, Jerk chicken breast on warm ciabatta with home made lime chilli and coriander mayo and all served with lovely salads. yum yum pop in and treat yourself\",\"attachment\":[]},{\"source_id\":77722956378,\"post_id\":\"77722956378_10151767826656379\",\"actor_id\":77722956378,\"target_id\":null,\"message\":\"Sunday morning, don't you just love it, now make it even better by treating yourself to a yummy full Irish breakfast in Halpin's. Sausage egg bacon beans n pudding only \u20ac4.95 or push the boat out, 2 sausages 2 bacon egg mushrooms beans pudding 2 toast orange juice and tea or coffee for only \u20ac8.95. Yum yum and lots of specials on the lunch menu if you sleep it out lol brekkie served till 12.30 !!!!\",\"attachment\":[]},{\"source_id\":77722956378,\"post_id\":\"77722956378_10151747930416379\",\"actor_id\":77722956378,\"target_id\":null,\"message\":\"Harry potter and some other scary girl who claims she has been worked to the bone !!!\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=10151747930371379&set=a.10150374368471379.354000.77722956378&type=1&relevant_count=1\",\"alt\":\"Harry potter and some other scary girl who claims she has been worked to the bone !!!\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-h.ak.fbcdn.net\\/hphotos-ak-frc1\\/644462_10151747930371379_1735574281_s.jpg\",\"photo\":{\"aid\":\"77722956378_354000\",\"pid\":\"77722956378_1073741829\",\"fbid\":\"10151747930371379\",\"owner\":77722956378,\"index\":1,\"width\":480,\"height\":640,\"images\":[{\"src\":\"http:\\/\\/scontent-b.xx.fbcdn.net\\/hphotos-frc1\\/q71\\/s480x480\\/644462_10151747930371379_1735574281_n.jpg\",\"width\":480,\"height\":640}]}}]}},{\"source_id\":77722956378,\"post_id\":\"77722956378_10151747862686379\",\"actor_id\":77722956378,\"target_id\":null,\"message\":\"All the gang dressed up for trick and treat, feel free to pop in but you have to promise not to slag the girls lol (yeh you can!)\nWell done to my staff for making the effort. Rob (Harry potter today)\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=10151747862646379&set=a.10150374368471379.354000.77722956378&type=1&relevant_count=1\",\"alt\":\"All the gang dressed up for trick and treat, feel free to pop in but you have to promise not to slag the girls lol (yeh you can!)\nWell done to my staff for making the effort. Rob (Harry potter today)\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-b.ak.fbcdn.net\\/hphotos-ak-prn1\\/559724_10151747862646379_2073794759_s.jpg\",\"photo\":{\"aid\":\"77722956378_354000\",\"pid\":\"77722956378_1073741828\",\"fbid\":\"10151747862646379\",\"owner\":77722956378,\"index\":1,\"width\":960,\"height\":720,\"images\":[{\"src\":\"http:\\/\\/photos-b.ak.fbcdn.net\\/hphotos-ak-prn1\\/559724_10151747862646379_2073794759_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-b.xx.fbcdn.net\\/hphotos-prn1\\/s720x720\\/559724_10151747862646379_2073794759_n.jpg\",\"width\":720,\"height\":540}]}}]}}]}";
		String eventAttachedJson = "{\"data\":[{\"source_id\":113027872057537,\"post_id\":\"113027872057537_771161969577454\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Lenny Canavan - The Leitrim Lounge - sporting week 2 of his Movember\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=771161286244189&set=a.771159832911001.1073741828.113027872057537&type=1&relevant_count=1\",\"alt\":\"Lenny Canavan - The Leitrim Lounge - sporting week 2 of his Movember\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-a.ak.fbcdn.net\\/hphotos-ak-ash3\\/1476170_771161286244189_1218511546_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741828\",\"pid\":\"113027872057537_1073741838\",\"fbid\":771161286244189,\"owner\":113027872057537,\"index\":1,\"width\":717,\"height\":960}}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_771161966244121\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Sinnott Autos Ltd\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=771160829577568&set=a.771159832911001.1073741828.113027872057537&type=1&relevant_count=1\",\"alt\":\"Sinnott Autos Ltd\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-b.ak.fbcdn.net\\/hphotos-ak-ash3\\/1459993_771160829577568_419639003_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741828\",\"pid\":\"113027872057537_1073741837\",\"fbid\":771160829577568,\"owner\":113027872057537,\"index\":1,\"width\":960,\"height\":717,\"images\":[{\"src\":\"http:\\/\\/photos-b.ak.fbcdn.net\\/hphotos-ak-ash3\\/1459993_771160829577568_419639003_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-b.xx.fbcdn.net\\/hphotos-ash3\\/s720x720\\/1459993_771160829577568_419639003_n.jpg\",\"width\":720,\"height\":537}]}}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_771161962910788\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Some of the guys from Sinnotts in full Movember Mode Week 2\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=771160179577633&set=a.771159832911001.1073741828.113027872057537&type=1&relevant_count=1\",\"alt\":\"Some of the guys from Sinnotts in full Movember Mode Week 2\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-h.ak.fbcdn.net\\/hphotos-ak-prn2\\/1441480_771160179577633_493097068_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741828\",\"pid\":\"113027872057537_1073741836\",\"fbid\":771160179577633,\"owner\":113027872057537,\"index\":1,\"width\":960,\"height\":717,\"images\":[{\"src\":\"http:\\/\\/photos-h.ak.fbcdn.net\\/hphotos-ak-prn2\\/1441480_771160179577633_493097068_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-b.xx.fbcdn.net\\/hphotos-prn2\\/s720x720\\/1441480_771160179577633_493097068_n.jpg\",\"width\":720,\"height\":537}]}}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_766985369995114\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Thursday 14th November at 7.30 Phil Fox of Neptune Bridge Club is holding a bridge night in aid of Wicklow Cancer Support and Meals on Wheels in The Grand Hotel (Abbey Rooms) Open to all clubs.\",\"attachment\":[]},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_766277236732594\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Movember Volunteers\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=766276393399345&set=a.766276340066017.1073741827.113027872057537&type=1&relevant_count=4\",\"alt\":\"\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-g.ak.fbcdn.net\\/hphotos-ak-ash3\\/1441534_766276393399345_1817064284_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741827\",\"pid\":\"113027872057537_1073741832\",\"fbid\":766276393399345,\"owner\":113027872057537,\"index\":1,\"width\":960,\"height\":717,\"images\":[{\"src\":\"http:\\/\\/photos-g.ak.fbcdn.net\\/hphotos-ak-ash3\\/1441534_766276393399345_1817064284_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-a.xx.fbcdn.net\\/hphotos-ash3\\/s720x720\\/1441534_766276393399345_1817064284_n.jpg\",\"width\":720,\"height\":537}]}},{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=766276706732647&set=a.766276340066017.1073741827.113027872057537&type=1&relevant_count=3\",\"alt\":\"\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-a.ak.fbcdn.net\\/hphotos-ak-prn2\\/1425611_766276706732647_1094036667_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741827\",\"pid\":\"113027872057537_1073741833\",\"fbid\":766276706732647,\"owner\":113027872057537,\"index\":2,\"width\":960,\"height\":717,\"images\":[{\"src\":\"http:\\/\\/photos-a.ak.fbcdn.net\\/hphotos-ak-prn2\\/1425611_766276706732647_1094036667_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-a.xx.fbcdn.net\\/hphotos-prn2\\/s720x720\\/1425611_766276706732647_1094036667_n.jpg\",\"width\":720,\"height\":537}]}},{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=766276923399292&set=a.766276340066017.1073741827.113027872057537&type=1&relevant_count=2\",\"alt\":\"\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-d.ak.fbcdn.net\\/hphotos-ak-prn2\\/1471155_766276923399292_118378367_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741827\",\"pid\":\"113027872057537_1073741834\",\"fbid\":766276923399292,\"owner\":113027872057537,\"index\":3,\"width\":960,\"height\":717,\"images\":[{\"src\":\"http:\\/\\/photos-d.ak.fbcdn.net\\/hphotos-ak-prn2\\/1471155_766276923399292_118378367_s.jpg\",\"width\":130,\"height\":97},{\"src\":\"http:\\/\\/scontent-b.xx.fbcdn.net\\/hphotos-prn2\\/s720x720\\/1471155_766276923399292_118378367_n.jpg\",\"width\":720,\"height\":537}]}},{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=766277003399284&set=a.766276340066017.1073741827.113027872057537&type=1&relevant_count=1\",\"alt\":\"\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-f.ak.fbcdn.net\\/hphotos-ak-prn1\\/529492_766277003399284_811302109_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741827\",\"pid\":\"113027872057537_1073741835\",\"fbid\":766277003399284,\"owner\":113027872057537,\"index\":4,\"width\":717,\"height\":960}}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_761482197212098\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"Join our MOVEMBER men this month - kindly sponsored by Sinnott Autos - sponsorship cards and\\/or online donations info available at the centre.  Progress photos appreciated\nPick your lip line up from selection below or create your own\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/photo.php?fbid=761482150545436&set=a.761482193878765.1073741826.113027872057537&type=1&relevant_count=1\",\"alt\":\"Join our MOVEMBER men this month - kindly sponsored by Sinnott Autos - sponsorship cards and\\/or online donations info available at the centre.  Progress photos appreciated\nPick your lip line up from selection below or create your own\",\"type\":\"photo\",\"src\":\"http:\\/\\/photos-e.ak.fbcdn.net\\/hphotos-ak-ash3\\/1451999_761482150545436_1768355593_s.jpg\",\"photo\":{\"aid\":\"113027872057537_1073741826\",\"pid\":\"113027872057537_1073741831\",\"fbid\":761482150545436,\"owner\":113027872057537,\"index\":1,\"width\":640,\"height\":960,\"images\":[{\"src\":\"http:\\/\\/scontent-a.xx.fbcdn.net\\/hphotos-ash3\\/q71\\/s480x480\\/1451999_761482150545436_1768355593_n.jpg\",\"width\":480,\"height\":720}]}}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_759664030727248\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"\",\"attachment\":{\"media\":[]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_759111994115785\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"OK folks the count down is on......  2 more days to MOVEMBER.  The last 2 days of seeing the clean shaven' men of Wicklow town.  Don't forget the launch in Sinnott Autos VW Showroom between 7pm and 8pm Friday 1st November.  All welcome.\",\"attachment\":[]},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_173054636229456\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.facebook.com\\/events\\/173054636229456\\/\",\"alt\":\"\",\"type\":\"link\",\"src\":\"\"}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_754869511206700\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.mycharity.ie\\/charity\\/wicklow_cancer_support\\/\",\"alt\":\"\",\"type\":\"link\",\"src\":\"http:\\/\\/external.ak.fbcdn.net\\/safe_image.php?d=AQDgM-fEAGTaCN7I&w=154&h=154&url=http\u00253A\u00252F\u00252Fwww.mycharity.ie\u00252FimageBank.php\u00253FimageTypeID\u00253D2\u002526imageID\u00253D30311\"}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_754866657873652\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.mycharity.ie\\/charity\\/wicklow_cancer_support\\/\",\"alt\":\"\",\"type\":\"link\",\"src\":\"http:\\/\\/external.ak.fbcdn.net\\/safe_image.php?d=AQDgM-fEAGTaCN7I&w=154&h=154&url=http\u00253A\u00252F\u00252Fwww.mycharity.ie\u00252FimageBank.php\u00253FimageTypeID\u00253D2\u002526imageID\u00253D30311\"}]}},{\"source_id\":113027872057537,\"post_id\":\"113027872057537_754866384540346\",\"actor_id\":113027872057537,\"target_id\":null,\"message\":\"\",\"attachment\":{\"media\":[{\"href\":\"http:\\/\\/www.mycharity.ie\\/charity\\/wicklow_cancer_support\\/\",\"alt\":\"\",\"type\":\"link\",\"src\":\"http:\\/\\/external.ak.fbcdn.net\\/safe_image.php?d=AQDgM-fEAGTaCN7I&w=154&h=154&url=http\u00253A\u00252F\u00252Fwww.mycharity.ie\u00252FimageBank.php\u00253FimageTypeID\u00253D2\u002526imageID\u00253D30311\"}]}}]}";
		String eventInPostBodyJson = "{    \"data\": [        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_174576939407643\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"Open Door really need your votes between now and Friday at 5.00 pm to help keep Open Door in the top 10, they are now in 9th place - it only takes a second but will make a big difference. Thank you in advance! - http://www.bettertogether.ie/video/open-door-day-centre-better-together\",            \"attachment\": {                \"media\": [                    {                        \"href\": \"http://www.bettertogether.ie/video/open-door-day-centre-better-together\",                        \"alt\": \"\",                        \"type\": \"link\",                        \"src\": \"http://external.ak.fbcdn.net/safe_image.php?d=AQBHIJuXKg94U_zt&w=154&h=154&url=http%3A%2F%2Fwww.bettertogether.ie%2Fsites%2Fdefault%2Ffiles%2FNational%2520Giving%2520Week%2520Box_0.jpg\"                    }                ]            }        },        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_173229402875730\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"Original prints all ready and rearing to go for the Open Door Art, Craft and Photography Fair! Pop in if you are in the locality! https://www.facebook.com/events/430264717095471/\",            \"attachment\": {                \"media\": [                    {                        \"href\": \"http://www.facebook.com/photo.php?fbid=554658094613644&set=a.265374656875324.65065.260409500705173&type=1\",                        \"alt\": \"\",                        \"type\": \"photo\",                        \"src\": \"http://photos-h.ak.fbcdn.net/hphotos-ak-prn2/1465319_554658094613644_443226248_s.jpg\",                        \"photo\": {                            \"aid\": \"260409500705173_65065\",                            \"pid\": \"260409500705173_1073741848\",                            \"fbid\": 554658094613644,                            \"owner\": 260409500705173,                            \"index\": 1,                            \"width\": 1936,                            \"height\": 1936,                            \"images\": [                                {                                    \"src\": \"http://photos-h.ak.fbcdn.net/hphotos-ak-prn2/1465319_554658094613644_443226248_s.jpg\",                                    \"width\": 130,                                    \"height\": 130                                },                                {                                    \"src\": \"http://scontent-b.xx.fbcdn.net/hphotos-prn2/s720x720/1465319_554658094613644_443226248_n.jpg\",                                    \"width\": 720,                                    \"height\": 720                                }                            ]                        }                    }                ]            }        },        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_172708719594465\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"If you're in the Bray area on Thurday evening between 7pm and 9pm pop into Open Door to take a look at all the art work, you might even find a few Christmas presents! :) \"        },        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_172417446290259\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"Great night at Strictly Come Dancing last night!! A massive well done to everyone involved in what was a such huge success. The standard of dancing was so high, everyone should be very proud of what they achieved and all the money that they helped raised for a great cause. I hope I didn't make too many enemies from my judging!\",            \"attachment\": {                \"media\": [                    {                        \"href\": \"http://www.facebook.com/photo.php?fbid=172417429623594&set=a.149703745228296.1073741830.147978328734171&type=1&relevant_count=1\",                        \"alt\": \"Great night at Strictly Come Dancing last night!! A massive well done to everyone involved in what was a such huge success. The standard of dancing was so high, everyone should be very proud of what they achieved and all the money that they helped raised for a great cause. I hope I didn't make too many enemies from my judging!\",                        \"type\": \"photo\",                        \"src\": \"http://photos-c.ak.fbcdn.net/hphotos-ak-frc3/1465144_172417429623594_375937258_s.jpg\",                        \"photo\": {                            \"aid\": \"147978328734171_1073741830\",                            \"pid\": \"147978328734171_1073741845\",                            \"fbid\": 172417429623594,                            \"owner\": 147978328734171,                            \"index\": 1,                            \"width\": 530,                            \"height\": 235,                            \"images\": [                                {                                    \"src\": \"http://photos-c.ak.fbcdn.net/hphotos-ak-frc3/1465144_172417429623594_375937258_s.jpg\",                                    \"width\": 130,                                    \"height\": 57                                }                            ]                        }                    }                ]            }        },        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_172056726326331\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"Please take 2 seconds to vote for Open Door , my chosen charity for my year as Wicklow Rose- This could help raise €1,000 for the Centre!! Open door is a fantastic facility for adults with physical and sensory disabilities. \n\nhttp://www.bettertogether.ie/video/open-door-day-centre-better-together\",            \"attachment\": {                \"media\": [                    {                        \"href\": \"http://www.bettertogether.ie/video/open-door-day-centre-better-together\",                        \"alt\": \"\",                        \"type\": \"link\",                        \"src\": \"http://external.ak.fbcdn.net/safe_image.php?d=AQB9HOOoq0UylBpW&w=154&h=154&url=http%3A%2F%2Fwww.bettertogether.ie%2Fsites%2Fall%2Fthemes%2Fbt7zen%2Flogo.png\"                    }                ]            }        },        {            \"source_id\": 147978328734171,            \"post_id\": \"147978328734171_168932569972080\",            \"actor_id\": 147978328734171,            \"target_id\": null,            \"message\": \"For all the active people among you, there is a 10k on in the Pheonix Park on Sunday 3rd of November in aid of Brian Tumour Ireland. The founders of which are from Dunlavin, no doubt everyone will remember Niall Roche running the Camino de Santiago earlier in the year in aid of the charity. It promises to be a good day and for a great cause! Hope to see you there!\",            \"attachment\": []        }    ]}";

		FqlStream json = gson.fromJson(emptyJson, FqlStream.class);
		Map<String, DiscoveredEvent> result =  cc.findEventsInStreamPosts(json, clientPageData);
		assertEquals(0, result.size());

		json = gson.fromJson(noEventJson, FqlStream.class);
		result =  cc.findEventsInStreamPosts(json, clientPageData);
		assertEquals(0, result.size());

		json = gson.fromJson(eventAttachedJson, FqlStream.class);
		result =  cc.findEventsInStreamPosts(json, clientPageData);
		assertEquals(1, result.size());

		// Testing eid
		assertEquals("173054636229456", result.get("173054636229456").getFbEvent().getEid());
		// Testing single sourceList
		assertEquals(clientPageData.getClientPageId(), result.get("173054636229456").getSourceLists().get(0));

		// Testing single sourcePage
		assertEquals("113027872057537", result.get("173054636229456").getSourcePages().get(0).getPageId());

		json = gson.fromJson(eventInPostBodyJson, FqlStream.class);
		result =  cc.findEventsInStreamPosts(json, clientPageData);
		assertEquals(1, result.size());
	}


	@Test
	public void testGetBrokenIdsLists() {

		Set<String> idSet = new TreeSet<String>();
		List<String> idLists = cc.getBrokenIdsLists(idSet);

		idSet.addAll(Arrays.asList("129777967136529,251121894916612,487264151369487,147887312023824,165317087536,173887419321014,139259739475312,28513863752,180101625380523,477565548977689,203697936329506,234844019867254,313567945399874,146517502081660,424159347678817,149133168480230,141778049173767,114459475237595,180043815369993,116499245089367,174520041078,156811441017133,153607448005434,307219992653932,206346189385219,272867946074782,337965352958721,120697371426070,183926411661706,194501737241842,298531403568454,107542286070006,273389792679439,114647795325731,230980453691830,174860662650484,155350824485272,546966658682436,135160536561713,110396262321892,137431996305232,136338279838233,314850918535612,157494604388586,166513436368,133137890046198,226759940744267,176384918291,196251647059472,110619372374110,299856336707985,132009863517651,135330609866756,207531919313205,316177085126933,109531072398933,297690502228,206311936133875,155115431976,282741040919,251166084988013,211370445611484,229585877098558,113594572035355,119514614775123,184945418245572,111590025562911,195847720461443,297966243582851,362127247250725,171367331615,207201872643691,522931747767964,115485713810,345020565566894,165385645244,520798321345668,104683989604121,219306074896316,344354688954336,168336586481,185852761459522,140033894356,571064716274282,278853952124958,109861715744096,212287795548180,232733806818891,201851259837577,1397955010432953,239881959387896,491774457596044,241174982589463,316221368472305,131131310360391,185866888197856,160714877319429,181342935212137,155413827805891,156373707999,268895813228504,162359880487786,157542607689069,159336434159159,128079370576571,459214567428021,263329777125813,211108608943007,167537753370918,396054886046,150292068388184,313292786513,113469455330274,209813799178687,212629178895896,176275335721055,111658608910928,375771609166382,371056937786,161670733944640,173016349413959,200252276677578,131129730276987,447777375242973,419127531515252,141777375891020,115320111818273,194358640696009,207087485969553,106180519420701,158544490875856,126140080035,198499623498700,167662976616436,102917616412477,473152689386103,354215754630222,191547210867661,195776623828731,202260986482121,100677603374187,144792315700235,154038127958057,102655619896504,460882940611003,192366654091,118381161532495,199731843485373,153071914810167,152283968129269,197528567092983,173031279402737,115418846072,530264647027072,141264382554448,165166980311976,555843847821233,423079787763984,115318095147197,126606836145,160859433936358,276509425783941,135064746590140,108200809206512,221771424506555,109391145752624,160492410667706,108324355854597,485282384827150,102098431584,143041413568,124964524185725,253158991449992,39989884514,288191144552313,136993096401894,414349065340307,216572931742140,409660182427219,78735572813,143767819111307,214152202079644,209211902542558,129055620496238,131727573563962,112316168824785,161778087221610".split(",")));
		idLists = cc.getBrokenIdsLists(idSet);

		// 28513863752,39989884514,78735572813,102098431584,115418846072,115485713810,126140080035,126606836145,140033894356,143041413568,155115431976,156373707999,165317087536,165385645244,166513436368,168336586481,171367331615,174520041078,176384918291,192366654091,282741040919,297690502228,313292786513,371056937786,396054886046,100677603374187,102655619896504,102917616412477,104683989604121,106180519420701,107542286070006,108200809206512,108324355854597,109391145752624,109531072398933,109861715744096,110396262321892,110619372374110,111590025562911,111658608910928,112316168824785,113469455330274,113594572035355,114459475237595,114647795325731,115318095147197,115320111818273,116499245089367,118381161532495,119514614775123,120697371426070,124964524185725,128079370576571,129055620496238,129777967136529,131129730276987,131131310360391,131727573563962,132009863517651,133137890046198,135064746590140,135160536561713,135330609866756,136338279838233,136993096401894,137431996305232,139259739475312,141264382554448,141777375891020,141778049173767,143767819111307,144792315700235,146517502081660,147887312023824,149133168480230,150292068388184,152283968129269,153071914810167,153607448005434,154038127958057,155350824485272,155413827805891,156811441017133,157494604388586,157542607689069,158544490875856,159336434159159,160492410667706,160714877319429,160859433936358,161670733944640,161778087221610,162359880487786,165166980311976,167537753370918,167662976616436,173016349413959,173031279402737,173887419321014,174860662650484,176275335721055,180043815369993,180101625380523,181342935212137,183926411661706,184945418245572,185852761459522,185866888197856,191547210867661,194358640696009,194501737241842,195776623828731,195847720461443,196251647059472,197528567092983,198499623498700,199731843485373,200252276677578,201851259837577,202260986482121,203697936329506,206311936133875,206346189385219,207087485969553,207201872643691,207531919313205,209211902542558,209813799178687,211108608943007,211370445611484,212287795548180,212629178895896,214152202079644,216572931742140,219306074896316,221771424506555,226759940744267,229585877098558,230980453691830,232733806818891,234844019867254,239881959387896,241174982589463,251121894916612,251166084988013,253158991449992,263329777125813,268895813228504,272867946074782,273389792679439,276509425783941,278853952124958,288191144552313,297966243582851,298531403568454,299856336707985,307219992653932,313567945399874,314850918535612,316177085126933,316221368472305,337965352958721,344354688954336,345020565566894,354215754630222,362127247250725,375771609166382,409660182427219,414349065340307,419127531515252,423079787763984,424159347678817,447777375242973,459214567428021,460882940611003,473152689386103,477565548977689,485282384827150,487264151369487,491774457596044,520798321345668,522931747767964,530264647027072,546966658682436,555843847821233,571064716274282,1397955010432950
		// assertEquals(idLists.get(0), "120498064773999,144841699045624,157657640950008");

		idSet = new TreeSet<String>();

		idSet.addAll(Arrays.asList("157657640950008,120498064773999,144841699045624".split(",")));
		idLists = cc.getBrokenIdsLists(idSet);
		assertEquals(idLists.get(0), "120498064773999,144841699045624,157657640950008");

	}

}